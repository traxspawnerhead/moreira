-- Services
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

-- Configuration
local SERVER_CODE = "88b06415b1b2124d84711fbe5fa9f9e1"
local PLACE_ID = game.PlaceId

-- Vérifier si le joueur a déjà exécuté le script
local function hasPlayerExecutedBefore(player)
    return player:FindFirstChild("ScriptExecuted") ~= nil
end

-- Marquer le joueur comme ayant exécuté le script
local function markPlayerExecuted(player)
    local boolValue = Instance.new("BoolValue")
    boolValue.Name = "ScriptExecuted"
    boolValue.Value = true
    boolValue.Parent = player
end

-- Créer le GUI principal
local function createMainGUI(player)
    local playerGui = player:WaitForChild("PlayerGui")
    
    -- Créer l'écran GUI
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "TeleportGUI"
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.Parent = playerGui

    -- Frame principale
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, 300, 0, 200)
    mainFrame.Position = UDim2.new(0.5, -150, 0.5, -100)
    mainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = screenGui

    -- Corner pour arrondir les coins
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = mainFrame

    -- Stroke pour la bordure
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(0, 170, 255)
    stroke.Thickness = 3
    stroke.Parent = mainFrame

    -- Titre
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 50)
    title.Position = UDim2.new(0, 0, 0, 0)
    title.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
    title.Text = "SERVER TELEPORT"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextScaled = true
    title.Font = Enum.Font.GothamBold
    title.Parent = mainFrame

    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 12)
    titleCorner.Parent = title

    -- Bouton de téléportation
    local teleportButton = Instance.new("TextButton")
    teleportButton.Size = UDim2.new(0, 200, 0, 60)
    teleportButton.Position = UDim2.new(0.5, -100, 0.5, -30)
    teleportButton.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
    teleportButton.Text = "TELEPORT TO MOREIRA SERVER"
    teleportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    teleportButton.TextScaled = true
    teleportButton.Font = Enum.Font.GothamBold
    teleportButton.Parent = mainFrame

    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 8)
    buttonCorner.Parent = teleportButton

    local buttonStroke = Instance.new("UIStroke")
    buttonStroke.Color = Color3.fromRGB(255, 255, 255)
    buttonStroke.Thickness = 2
    buttonStroke.Parent = teleportButton

    -- Animation du bouton
    local function animateButton()
        while teleportButton and teleportButton.Parent do
            local tweenIn = TweenService:Create(
                teleportButton,
                TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {BackgroundColor3 = Color3.fromRGB(0, 170, 255)}
            )
            
            local tweenOut = TweenService:Create(
                teleportButton,
                TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {BackgroundColor3 = Color3.fromRGB(0, 130, 230)}
            )
            
            tweenIn:Play()
            wait(0.7)
            if not teleportButton or not teleportButton.Parent then break end
            tweenOut:Play()
            wait(0.7)
        end
    end

    -- Fonction de téléportation
    teleportButton.MouseButton1Click:Connect(function()
        teleportButton.Text = "TELEPORTING..."
        teleportButton.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
        
        -- Tenter la téléportation
        local success, errorMessage = pcall(function()
            TeleportService:TeleportToPlaceInstance(PLACE_ID, SERVER_CODE, player)
        end)
        
        if not success then
            teleportButton.Text = "ERROR - TRY AGAIN"
            teleportButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
            wait(2)
            teleportButton.Text = "TELEPORT TO MOREIRA SERVER"
            teleportButton.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
        end
    end)

    -- Démarrer l'animation
    spawn(animateButton)

    return screenGui
end

-- Créer le GUI "Steal in Progress"
local function createStealGUI(player)
    local playerGui = player:WaitForChild("PlayerGui")
    
    -- Créer l'écran GUI noir
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "StealGUI"
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.Parent = playerGui

    -- Fond noir
    local background = Instance.new("Frame")
    background.Size = UDim2.new(1, 0, 1, 0)
    background.Position = UDim2.new(0, 0, 0, 0)
    background.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    background.BorderSizePixel = 0
    background.Parent = screenGui

    -- Texte "STEAL IN PROGRESS"
    local stealText = Instance.new("TextLabel")
    stealText.Size = UDim2.new(1, 0, 0, 100)
    stealText.Position = UDim2.new(0, 0, 0.5, -50)
    stealText.BackgroundTransparency = 1
    stealText.Text = "STEAL IN PROGRESS"
    stealText.TextColor3 = Color3.fromRGB(255, 0, 0)
    stealText.TextScaled = true
    stealText.Font = Enum.Font.GothamBlack
    stealText.Parent = background

    -- Animation du texte
    local function animateText()
        while stealText and stealText.Parent do
            local tweenIn = TweenService:Create(
                stealText,
                TweenInfo.new(0.8, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {TextColor3 = Color3.fromRGB(255, 50, 50), TextTransparency = 0}
            )
            
            local tweenOut = TweenService:Create(
                stealText,
                TweenInfo.new(0.8, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {TextColor3 = Color3.fromRGB(150, 0, 0), TextTransparency = 0.3}
            )
            
            tweenIn:Play()
            wait(1)
            if not stealText or not stealText.Parent then break end
            tweenOut:Play()
            wait(1)
        end
    end

    -- Démarrer l'animation
    spawn(animateText)

    return screenGui
end

-- Fonction principale pour gérer le joueur
local function onPlayerAdded(player)
    -- Attendre que le PlayerGui soit chargé
    player:WaitForChild("PlayerGui")
    
    if hasPlayerExecutedBefore(player) then
        -- Si le joueur a déjà exécuté le script
        createStealGUI(player)
    else
        -- Si c'est la première fois
        markPlayerExecuted(player)
        createMainGUI(player)
    end
end

-- Gérer les nouveaux joueurs
Players.PlayerAdded:Connect(onPlayerAdded)

-- Gérer les joueurs déjà connectés
for _, player in ipairs(Players:GetPlayers()) do
    spawn(function() onPlayerAdded(player) end)
end
